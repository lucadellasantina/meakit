<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of util_plot_channel_of_state</title>
  <meta name="keywords" content="util_plot_channel_of_state">
  <meta name="description" content="UTIL_PLOT_CHANNEL_OF_STATE Visualize the network states by showing">
  <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
    <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html Plot -->
<h1>util_plot_channel_of_state
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>UTIL_PLOT_CHANNEL_OF_STATE Visualize the network states by showing</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [ ch_state ] = util_plot_channel_of_state( network_vectors, seq, clu_sub, threshold, method, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment" style="background-image:url(../brain.png)"><pre class="comment">UTIL_PLOT_CHANNEL_OF_STATE Visualize the network states by showing
channels participating in each state. This function will also do the
hierarchical clustering results of these channels and their states.

   Input:
           network_vector:     Network activity vectors (elecs * bins)
           seq:                The channel sequence indexer for
                               network_vector (very important when you
                               pickoff some 'inactive' channels).
           clu_sub:            The clustering results, generated by
                               util_extract_cluster. Through this, each
                               bin is assigned to a clustered state.
           threshold:          The threshold for determining whether the
                               electrode is participating. 
                               [default]: 1. You may increase it with your
                               bin length (1:1000 ms), if = 0, channels
                               with few firings can be counted.
           method:             Visualization method.
                               'dots': Plot an 8*8 dots graph showing each
                                       state's own electrodes.
                               'hier': Hierarchical clustering results.
           subplots:            If true, 'dots' will be ploted in one
                               chart. [default]: false.
           hp:                 p-value in hierarchical clustering.
                               [default] is autofit. Recommend - 0
           axisoff:            Don't display axis in hierarchical
                               clustering. [default]: true
           colored:            Colored hierarchical clustering results.
                               [default]: false
           
   Output:
           ch_state:           A structure array.
                               ch_state.c1.electrodes = all electrodes
                               participated in state cluster 1.
                               ch_state.c1.bins = all bins in state 1.

   Example:
           [ ch_state ] = util_plot_channel_of_state( network_vectors,
           seq, subscript, 2, 'dots', 'subplots', 1 );
           [ ch_state ] = util_plot_channel_of_state( network_vectors,
           seq, subscript, 2, 'hier', 'hp', 0);

   Created on Jul/28/2010 By Pu Jiangbo
   Britton Chance Center for Biomedical Photonics

   $Revision:
       PJB#2010-07-29  Correcting the wrong hierarchical clustering
                       inputs, the channel id should not be appeared in
                       the input of pdist. We should use the permutation
                       index from dendrogram to get the correct channel
                       layout.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment" style="background-image:url(../brain.png)">
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../Calculation/util_convert_struct_2_vector_cluster.html" class="code" title="function [ cluvector ] = util_convert_struct_2_vector_cluster( clu_sub )">util_convert_struct_2_vector_cluster</a>	UTIL_CONVERT_STRUCT_2_VECTOR_CLUSTER Convert the clustering result from a</li><li><a href="../Common/util_convert_hw2ch.html" class="code" title="function [results] = util_convert_hw2ch(input)">util_convert_hw2ch</a>	UTIL_CONVERT_CH2HW Convert hardware ID into channel ID</li><li><a href="../Common/util_find_a_in_b.html" class="code" title="function [ isFind loc_a loc_b ] = util_find_a_in_b( a, b, varargin )">util_find_a_in_b</a>	UTIL_FIND_A_IN_B Find whether one element of B equals each element of A</li><li><a href="../IO/mcd/mcintfac/@datastrm/contents.html" class="code" title="">contents</a>	Contents of z:\mfiles\meatools\mcintfac\@datastrm</li><li><a href="../IO/mcd/mcintfac/pvpmod.html" class="code" title="function pvpmod(x)">pvpmod</a>	PVPMOD             - evaluate parameter/value pairs</li><li><a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../Scripts/network_states.html" class="code" title="">network_states</a>	</li></ul>
</div>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment" style="background-image:url(../brain.png)"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ ch_state ] = util_plot_channel_of_state( network_vectors, seq, clu_sub, threshold, method, varargin )</a>
0002 <span class="comment">%UTIL_PLOT_CHANNEL_OF_STATE Visualize the network states by showing</span>
0003 <span class="comment">%channels participating in each state. This function will also do the</span>
0004 <span class="comment">%hierarchical clustering results of these channels and their states.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   Input:</span>
0007 <span class="comment">%           network_vector:     Network activity vectors (elecs * bins)</span>
0008 <span class="comment">%           seq:                The channel sequence indexer for</span>
0009 <span class="comment">%                               network_vector (very important when you</span>
0010 <span class="comment">%                               pickoff some 'inactive' channels).</span>
0011 <span class="comment">%           clu_sub:            The clustering results, generated by</span>
0012 <span class="comment">%                               util_extract_cluster. Through this, each</span>
0013 <span class="comment">%                               bin is assigned to a clustered state.</span>
0014 <span class="comment">%           threshold:          The threshold for determining whether the</span>
0015 <span class="comment">%                               electrode is participating.</span>
0016 <span class="comment">%                               [default]: 1. You may increase it with your</span>
0017 <span class="comment">%                               bin length (1:1000 ms), if = 0, channels</span>
0018 <span class="comment">%                               with few firings can be counted.</span>
0019 <span class="comment">%           method:             Visualization method.</span>
0020 <span class="comment">%                               'dots': Plot an 8*8 dots graph showing each</span>
0021 <span class="comment">%                                       state's own electrodes.</span>
0022 <span class="comment">%                               'hier': Hierarchical clustering results.</span>
0023 <span class="comment">%           subplots:            If true, 'dots' will be ploted in one</span>
0024 <span class="comment">%                               chart. [default]: false.</span>
0025 <span class="comment">%           hp:                 p-value in hierarchical clustering.</span>
0026 <span class="comment">%                               [default] is autofit. Recommend - 0</span>
0027 <span class="comment">%           axisoff:            Don't display axis in hierarchical</span>
0028 <span class="comment">%                               clustering. [default]: true</span>
0029 <span class="comment">%           colored:            Colored hierarchical clustering results.</span>
0030 <span class="comment">%                               [default]: false</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%   Output:</span>
0033 <span class="comment">%           ch_state:           A structure array.</span>
0034 <span class="comment">%                               ch_state.c1.electrodes = all electrodes</span>
0035 <span class="comment">%                               participated in state cluster 1.</span>
0036 <span class="comment">%                               ch_state.c1.bins = all bins in state 1.</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%   Example:</span>
0039 <span class="comment">%           [ ch_state ] = util_plot_channel_of_state( network_vectors,</span>
0040 <span class="comment">%           seq, subscript, 2, 'dots', 'subplots', 1 );</span>
0041 <span class="comment">%           [ ch_state ] = util_plot_channel_of_state( network_vectors,</span>
0042 <span class="comment">%           seq, subscript, 2, 'hier', 'hp', 0);</span>
0043 <span class="comment">%</span>
0044 <span class="comment">%   Created on Jul/28/2010 By Pu Jiangbo</span>
0045 <span class="comment">%   Britton Chance Center for Biomedical Photonics</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%   $Revision:</span>
0048 <span class="comment">%       PJB#2010-07-29  Correcting the wrong hierarchical clustering</span>
0049 <span class="comment">%                       inputs, the channel id should not be appeared in</span>
0050 <span class="comment">%                       the input of pdist. We should use the permutation</span>
0051 <span class="comment">%                       index from dendrogram to get the correct channel</span>
0052 <span class="comment">%                       layout.</span>
0053 
0054 <a href="../IO/mcd/mcintfac/pvpmod.html" class="code" title="function pvpmod(x)">pvpmod</a>(varargin);
0055 
0056 <span class="keyword">if</span> ~exist(<span class="string">'subplots'</span>, <span class="string">'var'</span>)
0057     subplots = false;
0058 <span class="keyword">end</span>
0059 
0060 <span class="keyword">if</span> ~exist(<span class="string">'axisoff'</span>, <span class="string">'var'</span>)
0061     axisoff = true;
0062 <span class="keyword">end</span>
0063 
0064 <span class="keyword">if</span> ~exist(<span class="string">'colored'</span>, <span class="string">'var'</span>)
0065     colored = false;
0066 <span class="keyword">end</span>
0067 
0068 <span class="comment">% Convert structure to vector</span>
0069 clu_vec = <a href="../Calculation/util_convert_struct_2_vector_cluster.html" class="code" title="function [ cluvector ] = util_convert_struct_2_vector_cluster( clu_sub )">util_convert_struct_2_vector_cluster</a>(clu_sub);
0070 
0071 <span class="comment">% Find number of clusters</span>
0072 num_cluster = max(clu_vec);
0073 num_points = length(clu_vec);
0074 
0075 <span class="comment">% Loop</span>
0076 <span class="keyword">for</span> i = 1:num_cluster
0077     <span class="comment">% Init</span>
0078     ch_state.([<span class="string">'c'</span> num2str(i)]).electrodes = [];
0079     ch_state.([<span class="string">'c'</span> num2str(i)]).bins = (clu_vec == i);
0080     
0081     <span class="comment">% Collect bins in this state</span>
0082     state_bins = network_vectors(:, ch_state.([<span class="string">'c'</span> num2str(i)]).bins);
0083     
0084     <span class="comment">% Collect participated channels</span>
0085     <span class="keyword">for</span> j = 1:size(state_bins, 2)
0086         <span class="keyword">if</span> threshold == 0
0087             ch = seq(state_bins(:, j) &gt; threshold);
0088         <span class="keyword">else</span>
0089             ch = seq(state_bins(:, j) &gt;= threshold);
0090         <span class="keyword">end</span>
0091         ch_state.([<span class="string">'c'</span> num2str(i)]).electrodes = unique([ch_state.([<span class="string">'c'</span> num2str(i)]).electrodes <a href="../Common/util_convert_hw2ch.html" class="code" title="function [results] = util_convert_hw2ch(input)">util_convert_hw2ch</a>(ch)]);
0092     <span class="keyword">end</span>
0093 <span class="keyword">end</span>
0094 
0095 <span class="comment">% Visualization</span>
0096 <span class="comment">% Prepare colors</span>
0097 colors = jet(num_cluster);
0098 
0099 <span class="keyword">if</span> strcmpi(method, <span class="string">'dots'</span>)
0100     <span class="keyword">if</span> subplots
0101         figure
0102     <span class="keyword">end</span>
0103     <span class="keyword">for</span> clu = 1:num_cluster
0104         <span class="comment">% Prepare scatter</span>
0105         sc_x = zeros(64, 1);
0106         sc_y = zeros(64, 1);
0107         sc_f = zeros(64, 3);    <span class="comment">% Facecolor</span>
0108         s = 1;
0109         <span class="keyword">for</span> i = 1:8
0110             <span class="keyword">for</span> j = 1:8
0111                 sc_x(s) = i;
0112                 sc_y(s) = j;
0113                 <span class="keyword">if</span> i==1&amp;&amp;j==1 || i==1&amp;&amp;j==8 || i==8&amp;&amp;j==1 || i==8&amp;&amp;j==8
0114                     <span class="comment">% Corner</span>
0115                     sc_f(s, :) = [1 1 1];
0116                 <span class="keyword">elseif</span> <a href="../Common/util_find_a_in_b.html" class="code" title="function [ isFind loc_a loc_b ] = util_find_a_in_b( a, b, varargin )">util_find_a_in_b</a>(i*10+j, ch_state.([<span class="string">'c'</span> num2str(clu)]).electrodes)
0117                     <span class="comment">% Participated</span>
0118                     sc_f(s, :) = colors(clu, :);
0119                 <span class="keyword">else</span>
0120                     <span class="comment">% Not participated</span>
0121                     sc_f(s, :) = [1 1 1];
0122                 <span class="keyword">end</span>
0123                 s = s + 1;
0124             <span class="keyword">end</span>
0125         <span class="keyword">end</span>
0126         
0127         <span class="keyword">if</span> subplots
0128             subplot(1, num_cluster, clu)
0129         <span class="keyword">else</span>
0130             figure
0131         <span class="keyword">end</span>
0132         
0133         <span class="comment">% Do job</span>
0134         scatter(sc_x, sc_y, 200, sc_f, <span class="string">'filled'</span>, <span class="string">'MarkerEdgeColor'</span>, [0 0 0]);
0135         
0136         <span class="comment">% Erase four corners</span>
0137         hold on, scatter([1 1 8 8], [1 8 1 8], 200, <span class="string">'MarkerFaceColor'</span>, [1 1 1], <span class="string">'MarkerEdgeColor'</span>, [1 1 1]), hold off
0138         <span class="comment">% Label four corners</span>
0139         adj = 0.1;
0140         text(1 - adj, 1, <span class="string">'11'</span>); text(1 - adj, 8, <span class="string">'18'</span>); text(8 - adj, 1, <span class="string">'81'</span>); text(8 - adj, 8, <span class="string">'88'</span>);
0141         
0142         <span class="comment">% Title / Label / Axis</span>
0143         axis ij;
0144         xlim([0 9]); <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'XTick'</span>, []); <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'XColor'</span>, [1 1 1]);
0145         ylim([0 9]); <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'YTick'</span>, []); <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'YColor'</span>, [1 1 1]);
0146         title([<span class="string">'State '</span> num2str(clu)]);
0147     <span class="keyword">end</span>
0148 <span class="keyword">elseif</span> strcmpi(method, <span class="string">'hier'</span>)
0149     <span class="comment">% Prepare the Hierarchical Clustering</span>
0150     hier_pair = [];
0151     <span class="keyword">for</span> i = 1:num_cluster
0152         <span class="keyword">for</span> j = 1:length(ch_state.([<span class="string">'c'</span> num2str(i)]).electrodes)
0153             hier_pair = [hier_pair; [ch_state.([<span class="string">'c'</span> num2str(i)]).electrodes(j) i]];
0154         <span class="keyword">end</span>
0155     <span class="keyword">end</span>
0156     
0157     <span class="comment">% Remove redundant electrodes</span>
0158     <span class="comment">% (elec: state1 state2 state3), not (elec1:state1, elec1:state2)</span>
0159     maxlength = 0;
0160     <span class="keyword">for</span> i = 1:length(seq)
0161         chid = <a href="../Common/util_convert_hw2ch.html" class="code" title="function [results] = util_convert_hw2ch(input)">util_convert_hw2ch</a>(seq(i));
0162         hier_pair_struct.([<span class="string">'e'</span> num2str(chid)]).states = [];
0163         <span class="keyword">for</span> j = 1:num_cluster
0164             <span class="keyword">if</span> <a href="../Common/util_find_a_in_b.html" class="code" title="function [ isFind loc_a loc_b ] = util_find_a_in_b( a, b, varargin )">util_find_a_in_b</a>(chid, ch_state.([<span class="string">'c'</span> num2str(j)]).electrodes)
0165                 hier_pair_struct.([<span class="string">'e'</span> num2str(chid)]).states = [hier_pair_struct.([<span class="string">'e'</span> num2str(chid)]).states j];
0166             <span class="keyword">end</span>
0167         <span class="keyword">end</span>
0168         <span class="keyword">if</span> length(hier_pair_struct.([<span class="string">'e'</span> num2str(chid)]).states) &gt; maxlength
0169             maxlength = length(hier_pair_struct.([<span class="string">'e'</span> num2str(chid)]).states);
0170         <span class="keyword">end</span>
0171     <span class="keyword">end</span>
0172     
0173     <span class="comment">% Convert to array</span>
0174     hier_pair_array = zeros(length(seq), maxlength + 1);
0175     <span class="keyword">for</span> i = 1:length(seq)
0176         chid = <a href="../Common/util_convert_hw2ch.html" class="code" title="function [results] = util_convert_hw2ch(input)">util_convert_hw2ch</a>(seq(i));
0177         hier_pair_array(i, 1) = chid;
0178         <a href="../IO/mcd/mcintfac/@datastrm/contents.html" class="code" title="">contents</a> = hier_pair_struct.([<span class="string">'e'</span> num2str(chid)]).states;
0179         hier_pair_array(i, 2:(length(<a href="../IO/mcd/mcintfac/@datastrm/contents.html" class="code" title="">contents</a>) + 1)) = <a href="../IO/mcd/mcintfac/@datastrm/contents.html" class="code" title="">contents</a>;
0180     <span class="keyword">end</span>
0181     
0182     <span class="comment">% Generate observation labels</span>
0183     obs_labels = {};
0184     <span class="keyword">for</span> i = 1:length(seq)
0185         obs_labels = [obs_labels, {num2str(hier_pair_array(i, 1))}];
0186     <span class="keyword">end</span>
0187     
0188     <span class="comment">% Separate channel list</span>
0189     ch_list = hier_pair_array(:, 1);
0190     hier_pair_array(:, 1) = [];
0191     
0192     distance = pdist(hier_pair_array, <span class="string">'seuclidean'</span>);
0193     linkages = linkage(distance, <span class="string">'average'</span>);
0194     <span class="keyword">if</span> ~exist(<span class="string">'hp'</span>, <span class="string">'var'</span>)
0195         figure, subplot(2,1,1), [H, T, perm] = dendrogram(linkages, <span class="string">'colorthreshold'</span>, <span class="string">'default'</span>, <span class="string">'labels'</span>, obs_labels);
0196         warning(<span class="string">'UTIL:PARAM'</span>, <span class="string">'hp is autofit, it may be wrong.'</span>)
0197     <span class="keyword">else</span>
0198         figure, subplot(2,1,1), [H, T, perm] = dendrogram(linkages, hp, <span class="string">'colorthreshold'</span>, <span class="string">'default'</span>, <span class="string">'labels'</span>, obs_labels);
0199         <span class="keyword">if</span> hp ~= 0
0200             warning(<span class="string">'UTIL:PARAM'</span>, <span class="string">'Not all leaves are showed, the arrangement of the electrodes may be wrong.'</span>);
0201         <span class="keyword">end</span>
0202     <span class="keyword">end</span>
0203     
0204     <span class="keyword">if</span> axisoff
0205         axis off;
0206     <span class="keyword">end</span>
0207     
0208     <span class="keyword">if</span> ~colored
0209         <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(H, <span class="string">'Color'</span>, [0 0 0])
0210     <span class="keyword">end</span>
0211     
0212     <span class="comment">% Prepare the electrode plot</span>
0213     hier_im = zeros(num_cluster, length(seq));
0214     
0215     <span class="comment">% Fill the image</span>
0216     <span class="comment">% Color is determined by states</span>
0217     <span class="comment">% Position is determined by hierarchical clustering results</span>
0218     ch_pos = [];
0219     <span class="keyword">for</span> i = 1:length(perm)
0220         ch_pos = [ch_pos find(T == perm(i))'];
0221     <span class="keyword">end</span>
0222     ch_pos = ch_list(ch_pos);
0223     
0224     <span class="keyword">for</span> i = 1:num_cluster
0225         <span class="keyword">for</span> j = 1:length(seq)
0226             <span class="keyword">if</span> <a href="../Common/util_find_a_in_b.html" class="code" title="function [ isFind loc_a loc_b ] = util_find_a_in_b( a, b, varargin )">util_find_a_in_b</a>(ch_pos(j), ch_state.([<span class="string">'c'</span> num2str(i)]).electrodes)
0227                 hier_im(i, j) = i;
0228             <span class="keyword">else</span>
0229                 hier_im(i, j) = 0;
0230             <span class="keyword">end</span>
0231         <span class="keyword">end</span>
0232     <span class="keyword">end</span>
0233     
0234     <span class="comment">% Add color for 0</span>
0235     colors = [1 1 1; colors];
0236     
0237     <span class="comment">% Plot</span>
0238     subplot(2,1,2), imagesc(hier_im), colormap(colors);
0239     
0240     <span class="comment">% Label &amp; Ticks</span>
0241     xlabel(<span class="string">'Channel #'</span>);
0242     <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'XTick'</span>, [0.5:(length(seq)-0.5)]); <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'XTickLabel'</span>, num2str(ch_pos(:)));
0243     <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'YTick'</span>, [0.5:(num_cluster-0.5)]);
0244     yticklabel = {};
0245     <span class="keyword">for</span> i = 1:num_cluster
0246         yticklabel = [yticklabel {[<span class="string">'State '</span> num2str(i)]}];
0247     <span class="keyword">end</span>
0248     <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'YTickLabel'</span>, yticklabel);
0249     
0250     <span class="comment">% Grid</span>
0251     grid on; <a href="../Otherbox/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca, <span class="string">'GridLineStyle'</span>, <span class="string">'-'</span>);
0252 <span class="keyword">else</span>
0253     error(<span class="string">'Not suppoerted yet.'</span>);
0254 <span class="keyword">end</span>
0255 
0256 
0257 <span class="keyword">end</span></pre></div>
<hr><address>Copyright (C) 2008-2010 Pu Jiangbo @ Britton Chance Center for Biomedical Photonics<br/>Generated on Fri 22-Jun-2012 16:47:48</address>
</body>
</html>